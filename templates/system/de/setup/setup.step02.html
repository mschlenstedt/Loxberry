      <h2>2. Schritt: Miniserver einrichten</h2>

      <p>
      In diesem Schritt musst Du die Daten Deines Miniservers eingeben. Wir ben&ouml;tigen die IP-Adresse und Portnummer, unter der Dein Miniserver in Deinem Netzwerk
      erreichbar ist sowie auch Benutzername und Passwort des Administrator-Zugangs. Diese Daten sind notwendig, damit wir auf Daten des
      Miniservers zugreifen k&ouml;nnen und diesen auch steuern k&ouml;nnen. <b>Hinweis:</b> Solltest Du mehrere Miniserver in Deiner Installation verwenden, so kannst
      Du weitere Miniserver nach der Ersteinrichtung unter dem Menüpunkt "Miniserver" hinzufügen.
      </p>

      <p>
      Solltest Du Dir nicht sicher sein, unter welcher IP-Adresse Dein Miniserver im Netzwerk erreichbar ist, kannst Du den Scan-Button neben
      dem Eingabefeld verwenden. Der LoxBerry durchsucht dann Dein Netzwerk nach einem erreichbaren Miniserver und tr&auml;gt die entsprechende IP-Adresse im
      Eingabefeld ein. Auch in der Loxone Config-Software steht die IP-Adresse und die Portnummer des Miniservers im Verbindungsdialog. Dort k&ouml;nntest Du 
      nachschauen, wenn der Scan fehlschl&auml;gt.
      </p>

      <form method="post" data-ajax="false" name="main_form2" id="main_form2" action="/admin/system/setup/index.cgi?step=<!--$step-->&lang=<!--$lang-->&sid=<!--$sid-->">
      <input type="hidden" name="saveformdata" value="1">
      <div class="form-group">
        <table class="formtable" border="0" width="100%">
        <tr>
          <td width="25%">
          &nbsp;
          </td>
          <td width="50%">
          <label><input type="checkbox" id="useclouddns1" name="useclouddns1">Cloud DNS verwenden</label>
          </td>
          <td width="5%">
          &nbsp;
          </td>
          <td width="20%">
          &nbsp;
          </td>
        </tr>
         <tr width="25%" id="miniserveriprow1" ipaddr="<!--$miniserverip1-->">
          <td width="25%">
          <label class="control-label" for="miniserverip1">IP-Adresse oder Hostname:</label>
          </td>
          <td width="50%">
          <input id="miniserverip1" name="miniserverip1" type="text" class="textfield" data-validation="custom" value="<!--$miniserverip1-->"
          data-validation-regexp="(^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$)|(^[a-z0-9A-Z\.]+$)" data-validation-error-msg="* Du scheinst keine g&uuml;ltige IP-Adresse oder g&uuml;ltigen Hostnamen eingegeben zu haben. Eine IP-Adresse hat die Form xxx.xxx.xxx.xxx, z. B. 192.168.1.100<br>">
          </td>
          <td width="5%">
          <a id="btnnetscan" data-role="button" data-inline="true" data-mini="true" data-icon="check" href="#"><font size="-1">Scan</font>
          </td>
          <td width="20%">
          <font size="-1"><div id="testurl"></div></font>
          </td>
        </tr>
        <tr id="miniserverportrow1" portaddr="<!--$miniserverport1-->">
          <td>
          <label>Portnummer:</label>
          </td>
          <td>
          <input id="miniserverport1" name="miniserverport1" type="text" data-validation="number" data-validation-allowing="range[1;65535]" class="textfield" 
          value="<!--$miniserverport1-->" data-validation-error-msg="* Die Portnummer muss zwischen 1 und 65535 liegen. Der Standardport des Miniserver ist 80.">
          </td>
          <td>
          &nbsp;
          </td>
          <td>
          <font size="-1">Der Standardport ist <b>80</b></font>
          </td>
        </tr>
        <tr id="miniservercloudurlrow1" dnsurl="<!--$miniservercloudurl-->">
          <td width="25%">
          <label class="control-label" for="miniservercloudurl1">MAC-Adresse:</label>
          </td>
          <td width="50%">
          <input id="miniservercloudurl1" name="miniservercloudurl1" type="text" class="textfield" data-validation-optional="false" data-validation-depends-on="useclouddns1"  data-validation-depends-on-value="1" data-validation="custom" data-suggestions="EEE000xxxxxx" data-validation-regexp="(^EEE000([a-zA-Z0-9]{6})$)|(^504F([a-zA-Z0-9]{8})$)" data-validation-error-msg="* Bitte eine g&uuml;ltige MAC-Adresse eingeben. Beispiel: EEE000xxxxxx oder 504Fxxxxxxxx" value="<!--$miniservercloudurl-->">
          </td>
          <td width="5%">
           &nbsp;
          </td>
          <td width="20%">
          &nbsp;
          </td>
        </tr>
        <tr id="miniservercloudurlftpportrow1" dnsurlftpport="<!--$miniservercloudurlftpport-->">
          <td width="25%">
          <label class="control-label" for="miniservercloudurlftpport1">&Ouml;ffentlicher FTP-Port:</label>
          </td>
          <td width="50%">
          <input id="miniservercloudurlftpport1" name="miniservercloudurlftpport1" type="text" class="textfield"
          data-validation-optional="false" data-validation-depends-on="useclouddns1"  data-validation-depends-on-value="1" data-validation="custom length" data-validation-length="1-5" 
          data-validation-regexp="([0-9]$)" data-suggestions="21"
          data-validation-error-msg="* Bitte eine g&uuml;ltigen &ouml;ffentlichen FTP-Port des Miniservers eingeben. (Siehe Router Freigabe) Intern sollte der Miniserver FTP-Port 21 sein."
          value="<!--$miniservercloudurlftpport-->">
          </td>
          <td width="5%">
           &nbsp;
          </td>
          <td width="20%">
          &nbsp;
          </td>
        </tr>
        <tr>
          <td>
          <label>Miniserver Benutzername:</label>
          </td>
          <td>
          <input id="miniserveruser1" name="miniserveruser1" type="text" data-validation="length" data-validation-length="Min1" class="textfield"
          value="<!--$miniserveruser1-->" data-validation-error-msg="* Bitte gebe den Administratorzugang Deines Miniservers an.">
          </td>
          <td>
          &nbsp;
          </td>
          <td>
          <font size="-1"></font>
          </td>
        </tr>
        <tr>
          <td>
          <label>Miniserver Kennwort:</label>
          </td>
          <td>
          <input id="miniserverkennwort1" name="miniserverkennwort1" type="password" data-validation="length" data-validation-length="Min1" class="textfield"
          value="<!--$miniserverkennwort1-->" data-validation-error-msg="* Bitte gebe das Kennwort des Miniserver Administratorzugangs ein.">
          </td>
          <td>
          &nbsp;
          </td>
          <td>
          <font size="-1"></font>
          </td>
        </tr>
        <tr>
          <td>
          <label>Notiz / Link:</label>
          </td>
          <td>
					<SCRIPT>
						function isUrlValid(url) {
					    return /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);
					}
					</SCRIPT>
          <textarea id="miniservernote1" name="miniservernote1" type="textarea" class="textfield" data-validation-optional="true" data-validation="length letternumeric" data-validation-allowing=" ()@{}&:/?=#_+!-\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF" data-validation-error-msg="* Es sind nur folgende Zeichen erlaubt: a-z A-Z 0-9 {(@:/?=#_+!-&)} (Maximale L&auml;nge 512 Zeichen)" data-validation-length="Max512"><!--$miniservernote1--></textarea>
          <SCRIPT>
          	$("#miniservernote1").focusout(function() 
          	{
          		note_link($(this).attr("id"));
    	      })
				  	.blur(function() 
				  	{
          		note_link($(this).attr("id"));
       			});
       			function note_link (note_object)
       			{
       				if (isUrlValid($("#"+note_object).val()))
          		{
          			$("#"+note_object+"_url").attr("href",$("#"+note_object).val());
          			$("#"+note_object+"_url").css("visibility", "visible");
          		}
          		else
          		{
          			$("#"+note_object+"_url").attr("href","#");
          			$("#"+note_object+"_url").css("visibility", "hidden");
          		}	
       			};
       			note_link ("miniservernote1");
          </SCRIPT>
          </td>
          <td>
          <a id="miniservernote1_url" data-role="button" data-inline="true" data-mini="true" data-icon="star" href="#" target="miniserver_note">&Ouml;ffnen</a>
          </td>
          <td>
          <font size="-1"></font>
          </td>
        </tr>
        <tr>
          <td colspan=4>
          &nbsp;
          </td>
        </tr>
        <tr>
          <td></td>
          <td colspan=3>
          <div id="form-error-message" class="form-error-message"></div>
          </td>
        </tr>
        </table>
      </div>

      <p>
      &nbsp;
      </p>

      <p>
      <center>
      <a id="btncancel" data-role="button" data-inline="true" data-mini="true" data-icon="delete" href="/admin/index.cgi?lang=<!--$lang-->">Abbrechen</a>
      <a id="btnback" data-role="button" data-inline="true" data-mini="true" data-icon="arrow-l"
         href="/admin/system/setup/index.cgi?step=1&lang=<!--$lang-->&sid=<!--$sid-->" >Zur&uuml;ck</a>
      <button type="submit" form="main_form2" name="btnsubmit" id="btnsubmit" data-role="button" data-inline="true" data-mini="true" data-icon="check">Weiter zu Schritt 3</button>
      </center>
      </p>
      </form>

  <script>
  var $messages = $("#form-error-message");
  $.validate({
    modules : "security",
    errorMessagePosition : $messages,
  });
  </script>

<SCRIPT>
	   $("#useclouddns1").change(function() 
    { 
      if($(this).is(":checked")) 
      {
        $("#miniservercloudurl1").val($("#miniservercloudurlrow1").attr( "dnsurl" ));
				$("#miniservercloudurl1").attr("data-validation-optional","false");
  		  $("#miniservercloudurlrow1").fadeTo( "fast", 1 );
  		  $("#miniservercloudurl1").prop("readOnly", false);

        $("#miniservercloudurlftpport1").val($("#miniservercloudurlftpportrow1").attr( "dnsurlftpport" ));
				$("#miniservercloudurlftpport1").attr("data-validation-optional","false");
  		  $("#miniservercloudurlftpportrow1").fadeTo( "fast", 1 );
  		  $("#miniservercloudurlftpport1").prop("readOnly", false);

				$("#miniserverip1").attr("data-validation-optional","true");
        $("#miniserverip1").val("");
	  		$("#miniserverip1").trigger( "focus" );
  		  $("#miniserveriprow1").fadeTo( "fast", 0.3 );
  		  $("#miniserverip1").prop("readOnly", true);

				$("#miniserverport1").attr("data-validation-optional","true");
        $("#miniserverport1").val("");
	  		$("#miniserverport1").trigger( "focus" );
  		  $("#miniserverportrow1").fadeTo( "fast", 0.3 );
  		  $("#miniserverport1").prop("readOnly", true);

  		  $("#btnnetscan" ).fadeTo( "fast", 0 );
  		  $("#btnnetscan").css( "cursor", "default" );
  		  $("#testurl" ).fadeTo( "fast", 0 );
      }
      else
      {
				$("#miniservercloudurl1").attr("data-validation-optional","true");
  		  $("#miniservercloudurlrow1").fadeTo( "fast", 0.3 );
  		  $("#miniservercloudurl1").prop("readOnly", true);
        $("#miniservercloudurl1").val("");
	  		$("#miniservercloudurl1").trigger( "focus" );

				$("#miniservercloudurlftpport1").attr("data-validation-optional","true");
  		  $("#miniservercloudurlftpportrow1").fadeTo( "fast", 0.3 );
  		  $("#miniservercloudurlftpport1").prop("readOnly", true);
        $("#miniservercloudurlftpport1").val("");
	  		$("#miniservercloudurlftpport1").trigger( "focus" );

        $("#miniserverip1").val($("#miniserveriprow1").attr( "ipaddr" ));
				$("#miniserverip1").attr("data-validation-optional","false");
  		  $("#miniserveriprow1" ).fadeTo( "fast", 1 );
  		  $("#miniserverip1").prop("readOnly", false);

        $("#miniserverport1").val($("#miniserverportrow1").attr( "portaddr" ));
				$("#miniserverport1").attr("data-validation-optional","false");
  		  $("#miniserverportrow1" ).fadeTo( "fast", 1 );
  		  $("#miniserverport1").prop("readOnly", false);

  		  $("#btnnetscan" ).fadeTo( "fast", 1 );
  		  $("#btnnetscan").css( "cursor", "pointer" );
  		  $("#testurl" ).fadeTo( "fast", 1 );
  		}
    });

    $("#miniservercloudurl1").change(function() 
    { 
    	if ($("#useclouddns1").is(":checked"))
    	{
  			$("#miniservercloudurlrow1").attr( "dnsurl",$("#miniservercloudurl1").val());
      }
    });
    $("#miniservercloudurlftpport1").change(function() 
    { 
    	if ($("#useclouddns1").is(":checked"))
    	{
  			$("#miniservercloudurlftpportrow1").attr( "dnsurlftpport",$("#miniservercloudurlftpport1").val());
      }
    });
		$("#miniserverip1").change(function() 
    { 
    	if (!$("#useclouddns1").is(":checked"))
    	{
  			$("#miniserveriprow1").attr( "ipaddr",$("#miniserverip1").val());
      }
    });
    $("#miniserverport1").change(function() 
    { 
    	if (!$("#useclouddns1").is(":checked"))
    	{
  			$("#miniserverportrow1").attr( "portaddr",$("#miniserverport1").val());
      }
    });

	 $("#useclouddns1").prop("checked", "<!--$useclouddns-->");
   $("#useclouddns1").trigger( "change" );
</SCRIPT>

